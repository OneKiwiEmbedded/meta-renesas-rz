From 34dc7be39062322688e06b4b4b2f181beb796258 Mon Sep 17 00:00:00 2001
From: Hao Bui <hao.bui.yg@renesas.com>
Date: Tue, 10 May 2022 17:07:34 +0700
Subject: [PATCH] mmngrbuf: Port kernel modules mmngrbuf to kernel v5.10

Signed-off-by: Hao Bui <hao.bui.yg@renesas.com>
---
 drv/mmngr_buf_drv.c | 36 ++++--------------------------------
 1 file changed, 4 insertions(+), 32 deletions(-)

diff --git a/drv/mmngr_buf_drv.c b/drv/mmngr_buf_drv.c
index 732e40c..6cbe23f 100755
--- a/drv/mmngr_buf_drv.c
+++ b/drv/mmngr_buf_drv.c
@@ -158,8 +158,7 @@ static struct miscdevice misc = {
 	.fops		= &fops,
 };
 
-static int dmabuf_attach(struct dma_buf *buf, struct device *dev,
-	struct dma_buf_attachment *attach)
+static int dmabuf_attach(struct dma_buf *buf, struct dma_buf_attachment *attach)
 {
 	return 0;
 }
@@ -203,37 +202,14 @@ static void dmabuf_release(struct dma_buf *buf)
 
 }
 
-static int dmabuf_begin_cpu_access(struct dma_buf *buf, size_t size,
-	size_t length, enum dma_data_direction direction)
+static int dmabuf_begin_cpu_access(struct dma_buf *buf, enum dma_data_direction direction)
 {
 	return 0;
 }
 
-static void dmabuf_end_cpu_access(struct dma_buf *buf, size_t size,
-	size_t length, enum dma_data_direction direction)
-{
-
-}
-
-static void *dmabuf_kmap_atomic(struct dma_buf *buf, unsigned long page)
+static int dmabuf_end_cpu_access(struct dma_buf *buf, enum dma_data_direction direction)
 {
-	return NULL;
-}
-
-static void dmabuf_kunmap_atomic(struct dma_buf *buf, unsigned long page,
-	void *vaddr)
-{
-
-}
-
-static void *dmabuf_kmap(struct dma_buf *buf, unsigned long page)
-{
-	return NULL;
-}
-
-static void dmabuf_kunmap(struct dma_buf *buf, unsigned long page, void *vaddr)
-{
-
+	return 0;
 }
 
 static int dmabuf_mmap(struct dma_buf *buf, struct vm_area_struct *vma)
@@ -273,10 +249,6 @@ static const struct dma_buf_ops dmabuf_ops = {
 	.release = dmabuf_release,
 	.begin_cpu_access = dmabuf_begin_cpu_access,
 	.end_cpu_access = dmabuf_end_cpu_access,
-	.kmap_atomic = dmabuf_kmap_atomic,
-	.kunmap_atomic = dmabuf_kunmap_atomic,
-	.kmap = dmabuf_kmap,
-	.kunmap = dmabuf_kunmap,
 	.mmap = dmabuf_mmap,
 	.vmap = dmabuf_vmap,
 	.vunmap = dmabuf_vunmap,
-- 
2.7.4

